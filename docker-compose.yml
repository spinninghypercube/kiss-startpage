services:
  dashboard:
    image: python:3.12.8-slim-bookworm
    container_name: kiss-this-dashboard
    working_dir: /app
    command: ["python3", "/app/backend/dashboard_api.py"]
    restart: unless-stopped
    environment:
      PYTHONDONTWRITEBYTECODE: "1"
      DASH_BIND: "0.0.0.0"
      DASH_PORT: "8788"
      DASH_DATA_DIR: "/data"
      DASH_DEFAULT_CONFIG: "/app/dashboard-default-config.json"
      DASH_APP_ROOT: "/app"
      DASH_SESSION_TTL: "${DASH_SESSION_TTL:-43200}"
      DASH_ICON_INDEX_TTL: "${DASH_ICON_INDEX_TTL:-21600}"
      DASH_ICON_SEARCH_MAX_LIMIT: "${DASH_ICON_SEARCH_MAX_LIMIT:-30}"
      TZ: "${TZ:-UTC}"
    ports:
      - "${DASHBOARD_PUBLIC_PORT:-8080}:8788"
    volumes:
      - ./:/app:ro
      - dashboard_data:/data
    tmpfs:
      - /tmp
    healthcheck:
      test: ["CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://127.0.0.1:8788/health', timeout=5).read()"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 10s

volumes:
  dashboard_data:
